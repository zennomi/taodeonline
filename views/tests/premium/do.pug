html(lang="en" style=config.darkmode =='on' ? "--bs-white:#121212; --bs-dark:#eee; --bs-filter: invert(95%);" : "")
    head
        meta(charset="UTF-8")
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous")
        //- link(rel='stylesheet', href='/template/css/argon.min.css', type='text/css')
        title= test.name ? test.name : "Đề thi"            
        include ../../layouts/mathjax.pug
        script.
            window.MathJax.startup = {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => {
                        window.onload = function() {
                            var startBtn = document.getElementById('start-btn');
                            startBtn.innerHTML = '<i class="fad fa-pencil"></i>    Bắt đầu làm bài';
                            startBtn.disabled = false;
                        }
                    });
                }
            }
        style
            include /css/premium-test.css
        //- link(rel="stylesheet" href="/css/premium-test.css")
        include ../../layouts/favicon.pug
        link(rel='stylesheet', type='text/css', href='//cdn.jsdelivr.net/gh/hung1001/font-awesome-pro@8af0edd/css/all.css')
        script(src='//w.soundcloud.com/player/api.js') 
    body
        // None
        // Menu
        button#menuBtn.btn.btn-outline-success(type="button" data-bs-toggle="offcanvas" data-bs-target="#sidemenu" aria-controls="offcanvasScrolling")
            i.fas.fa-bars
        #sidemenu.offcanvas.offcanvas-start(data-bs-scroll="true"  tabindex="-1" aria-labelledby="offcanvasScrollingLabel")
            .offcanvas-header.align-items-start
                //- h5.offcanvas-title Menu hỗ trợ
                iframe#sc-widget.d-none(src="//w.soundcloud.com/player/?url=//soundcloud.com/dabootlegboy/sets/study-chill-lofi-hiphop?show_artwork=false")
                .d-flex.flex-wrap
                    button.d-block.me-2.btn.btn-outline-success.mb-1(onclick="toggleNightMode(this)")
                        if (style=config.darkmode == 'on')
                            i.fas.fa-sun
                            |  Light Mode
                        else
                            i.fas.fa-moon
                            |  Dark Mode
                    button#timeBtn.d-block.me-2.btn.btn-outline-success.mb-1(onclick="playOrPauseTime(this)")
                        i.fas.fa-pause
                        |  Tạm dừng
                    button.d-block.me-2.btn.btn-outline-success.mb-1(onclick="zoomOut()")
                        i.fas.fa-search-plus
                        |  Phóng to
                    button.d-block.me-2.btn.btn-outline-success.mb-1(onclick="zoomIn()")
                        i.fas.fa-search-minus
                        |  Thu nhỏ
                    button.d.block.me-2.btn.btn-outline-success.mb-2(onclick="fullScreenOrEsc(this)")
                        i.fas.fa-expand-wide
                        |  Toàn màn hình
                    .flex-grow-1.d-flex.justify-content-between.mb-1
                        button#preBtn.d-block.btn.btn-outline-success.mb-1(disabled)
                            i.fas.fa-step-backward
                        button#playBtn.d-block.btn.btn-outline-success.mb-1(disabled)
                            i.fas.fa-play
                        button#nextBtn.d-block.btn.btn-outline-success.mb-1(disabled)
                            i.fas.fa-step-forward
                        button#shuffleBtn.d-block.btn.btn-outline-success.mb-1(disabled)
                            i.fas.fa-exchange-alt
                    select#musicSelect.form-select.mb-1
                        option(value="//soundcloud.com/dabootlegboy/sets/study-chill-lofi-hiphop" selected) Lofi Chill
                        option(value="//soundcloud.com/user-11544854/sets/baroque-study") Baroque
                        option(value="//soundcloud.com/thenhan2501/sets/vn-remix") Vinahouse
                button(type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close")
            .offcanvas-body.sidenav
                h5 Thời gian còn lại: 
                p#leftTime= test.time + " phút"
                h5 Lối tắt
                .d-flex.justify-content-around.flex-wrap
                    each q, i in test.questions
                        a.mx-1.my-1(href="#q-"+q._id)= `Câu ${i+1}`
                    a.mb-1(href="#submit")
                        i.fad.fa-paper-plane
                        |    Nộp bài
                    a.mb-1(href="/")
                        i.fad.fa-home
                        |    Trang chủ

        // setting modal
        .modal.fade.hide#init-modal(tab-index=-1 data-bs-backdrop="static" data-bs-keyboard="false").text-center
            .modal-dialog.modal-dialog-centered
                .modal-content
                    .modal-header.justify-content-center
                        .h1.modal-title= test.name ? test.name : "Đề thi"
                    .modal-body
                        .d-flex.justify-content-around.flex-wrap
                            .mb-2
                                .text-success.h3
                                    i.fad.fa-hourglass-start
                                    |  
                                    span= test.time ? test.time + " phút" : "40 phút"
                            .mb-2
                                .text-success.h3
                                    i.fad.fa-list-ol
                                    |  
                                    span= test.questions.length + " câu"
                        //- img#qr-image(alt="QR Code")
                    .modal-body
                        button.d-block.w-75.btn.btn-success.btn-lg.mx-auto.mb-2#start-btn(type="button" data-bs-dismiss="modal" disabled)
                            | Chuẩn bị đề
                        .row.w-75.mx-auto.g-0
                            .col.me-2
                                button.w-100.btn.btn-warning(onclick="copyToClipboard('"+link+"')")
                                    i.fad.fa-copy
                                    |   Copy Link Đề
                            .col
                                a.w-100.btn.btn-danger(href="/tests/premium")
                                    i.fad.fa-undo-alt
                                    |   Trở về
                    if results.length > 0
                        .modal-body.border-top
                            .h5.d-inline.border-success.text-success.border-bottom.border-5
                                i.fad.fa-history
                                |   Lịch sử làm bài
                            table.table.text-center
                                thead
                                    tr
                                        th Bắt đầu lúc
                                        th Nộp bài lúc
                                tbody
                                    each result in results
                                        tr
                                            td
                                                a(href="/tests/"+test._id+"/view-result/"+result._id target="_blank")= result.started_time.toLocaleString('vi-VN')
                                            td
                                                a(href="/tests/"+test._id+"/view-result/"+result._id target="_blank")= result.finished_time ? result.finished_time.toLocaleString('vi-VN') : "Chưa nộp bài"
        // Notify
        .fixed-bottom(aria-live="polite" aria-atomic="true")
            .toast-container.position-absolute.bottom-0.end-0.p-4
        // Main Area
        .container(style="zoom: 1;")
            .card#resultCard.mt-5(style="display:none;")
                .card-header
                    .h5 Kết quả
                .card-body
                    p Số câu đúng: 
                        span#result
                        span= "/" + test.questions.length + " câu"
                    p Số lần rời khỏi khu vực thi: 
                        span#leaveTimes 0
                    p Thời điểm bắt đầu: 
                        span= (new Date()).toLocaleString('vi-VN')
                    p Thời gian còn lại: 
                        span#leftTimes



            h1.mt-2.text-success.text-center= test.name ? test.name : "Đề thi"
            .d-flex.justify-content-around
                p Đề thi gồm #{test.questions.length} câu.
                p
                    | Thời gian 
                    span#totalTimes= test.time ? test.time : 40
                    |  phút.
            p 
                b Họ và tên:
                |   #{user.displayName}.
            .fixed-bottom
                .progress.rounded-0
                    #progress-btn.progress-bar.bg-success
            .test-wrap.p-1(style="display: none;")
                each q, i in test.questions
                    .question(id="q-"+q._id data-id=q._id)
                        .question-wrap
                            b.text-success Câu #{i+1}: 
                            span !{q.question}
                        form.row.row-cols-1.row-cols-sm-2.no-gutters.mb-0(class = q.getMaxLengthChoice() < 24 ? "row-cols-md-4" : q.getMaxLengthChoice() < 48 ? "row-cols-md-2" : "row-cols-md-1")
                            each a,j in q.choices
                                .col.mb-1.d-flex.align-items-center
                                    .radio.radio-before.d-flex.align-items-center
                                        label.radio__input
                                            input(type="radio" name="radio" data-id=a._id)
                                            .radio__control= String.fromCharCode(65+j)
                                        .radio__label.ms-2
                                            | !{a.content}
                    .collapse(id="ans-"+q._id)
                        if q.answer
                            | !{q.answer}
                        else
                            | Câu này chưa có lời giải chi tiết.

                    hr
            button.d-block.mx-auto.btn.btn-success.mb-5#submit(onclick=`submitTest("${test._id}")`)
                i.fad.fa-paper-plane
                span.fw-bold   NỘP BÀI
        script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous")
        script.
            let testId = "#{test._id}", totalTimes = #{test.time*60*1000};
        script
            include /js/tests/premium/init.js
            include /js/helper/copy.js
            include /js/helper/fetch.js
            include /js/helper/notify.js
            include /js/tests/premium/helper.js
            include /js/tests/premium/player.js

        script.
            //- document.getElementById('qr-image').src = "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data="+location.href